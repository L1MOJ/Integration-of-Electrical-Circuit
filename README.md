
Simple project on temperature measurements using Cadence.
# 电路综合短学期实验报告

## 文献综述与理论模型建立

### 研究背景

新冠肺炎患者早期临床主要表现为发热与低烧，患者体温一般在37.3℃以上。根据国家交通运输部及各地省政府疫情防控相关要求，禁止体温超过37.3℃的人员进入公众场合。因此，自新冠肺炎疫情爆发以来，体温检测一直是发现疑似新冠肺炎患者、防止新冠病毒出现大范围感染扩散的最有效的手段之一。

传统的测量体温方式为人工定时水银体温计测量，这种测量方式存在着多种弊端。首先，水银体温计多选用玻璃材质，容易破损从而导致水银泄漏，进而导致汞中毒。其次，水银体温计在进行体温测量时需要人工计时，浪费被测者和测试者时间，增加了测试者感染风险。再次，水银体温计的查看方式为肉眼观察，这种方式极不方便且容易造成测量误差。另外，水银体温计是重复利用的且为接触式测量方式，如果消毒不彻底将会引发交叉感染。而便携式的红外测温仪材质安全、测温速度快、具有屏显和异常温度提示功能且为非接触式测温，可以实现对于传统水银温度计的有效替代，对于新冠肺炎的防治具有重大意义。

### 需求分析

学校作为人流量大、人员成分复杂的场所之一，属于新冠肺炎疫情防控中的薄弱环节。参考大多数学校的防疫政策，校门是学校防疫中最重要的一道屏障，在校门设置测温等严格的防疫措施，能够有效阻止新冠肺炎疫情从校外带入校内，从而避免可能的集聚性疫情危机。

### 项目目标

设计一个能够储存不同用户不同时间段体温的红外测温仪，添加蓝牙模块向手机或电脑发送储存的温度值并绘制24小时内的温度变化曲线。能够通过按键选择用户、测温时间、警告温度。按下按键测温时储存温度，并将温度显示在OLED屏幕上，若超过报警温度，则LCD屏幕显示警告，黄灯亮，蜂鸣器报警。

### 工作基础

##### 黑体辐射定律

由于组成物质的分子和原子无时无刻都处于运动状态，当物体温度高于热力学温度 0 K时，就会不断地向周围辐射电磁波。红外辐射又被称为红外线或者红外光，是电磁波的一种，波长在0.76μm-1000μm之间，通常可分为0.76μm-3μm的近红外、3μm-6μm的中红外、6μm-15μm远红外和15μm-1000μm的极远红外四个波段。红外线物体内分子和原子的运动越强烈，辐射能量越大，物体的温度就越高；相反，辐射能量越小，物体的温度越低。红外线物体内部的分子和原子运动的越剧烈，像外部辐射的能量就越大，进而物体的温度也会随之增高；相反，当辐射时的能量越小时，物体的温度就越低。由于红外辐射波谱很宽，物体发射的红外辐射量与波长有关。将能够吸收所有波段辐射的物体定义为绝对黑体（简称黑体），即黑体的吸收率为1。黑体是一个理化的物体模型，自然界中并不存在真正的黑体，但是可以人为的制造出吸收率接近 1 的人造黑体。

##### 红外测温方法

本项目主要采用热红外温度传感器进行测温，被测目标通过红外物镜照射到传感器的敏感材料上，引起敏感材料的某些物理性能的变化，通过测量这些物理性能的变化，就能够测出它吸收的能量或功率，这就是热红外温度传感器的基本工作原理。作为红外传感器的一种，MLX90614属于红外热电堆传感器，热电堆就是根据塞贝效应机理，接收到红外辐射时，热电堆上的各热电偶的电压叠加输出，从而将温度变化转化为电子信号放大出来。

## 电路的原理设计、分析和计算

### 电路原理图整体设计
![图片](https://user-images.githubusercontent.com/115352148/224482368-9c9596e3-d650-4e92-849b-0fb7f4ce09cc.png)

### 电源稳压模块

![图片](https://user-images.githubusercontent.com/115352148/224482388-1926c234-4168-4cca-9a07-01491116315f.png)

J1焊接电源正负极两根导线，通过自锁开关J2控制电源是否供电。当开关未按下时，DIN9V没有输入；按下后，使用LM7805稳压模块能将输入的9伏电池电压Vi转化成可以给单片机供电的5V电压Vo。Vo处接一0.1uF的滤波电容。

### LED指示模块、

![图片](https://user-images.githubusercontent.com/115352148/224482398-b08d82ca-5daf-4dcc-9300-196bce46a347.png)

通过三个共地发光二极管显示不同的工作状态。

BTACTIVE连接蓝牙模块的STATE引脚，当蓝牙成功连接时亮。

P20、P21则表示单片机正常工作和温度警告时的状态。

### 复位模块
![图片](https://user-images.githubusercontent.com/115352148/224482404-9e1eae5c-cdc9-4fbd-aa25-f60c8acaeddc.png)

电容起隔直流的作用，当按钮按下时RST段接入高电平，单片机复位。

### 蜂鸣器模块

![图片](https://user-images.githubusercontent.com/115352148/224482409-bce0811a-a364-41b4-8050-768f931bb284.png)

P21驱动蜂鸣器，当温度超过报警温度时，P21通过软件置0，NPN三极管导通，工作在放大区放大蜂鸣器驱动电流。

### 晶振

![图片](https://user-images.githubusercontent.com/115352148/224482413-36d7a90e-a32f-4a40-b09e-5c8d9aeb0bc1.png)

### LCD1602模块

![图片](https://user-images.githubusercontent.com/115352148/224482416-e5198cda-41f5-4d56-a591-2ef234207616.png)

RS、RW、E三个控制口接入P33、P34、P35；数据输入选择P1口。

### 按键控制模块

![图片](https://user-images.githubusercontent.com/115352148/224482419-3bcc9676-3a9d-4656-9a6f-cf544629416c.png)

当按键按下时通过软件检测对应口的电平状况，进一步控制。

### 单片机主体

![图片](https://user-images.githubusercontent.com/115352148/224482423-60c49674-0bf9-44c2-aecc-5cd0c687f4e6.png)

ALE，PSEN_N、P32脚未使用可以悬空，EA_N通过电阻与VCC相连读取片内ROM。

P07作为输入输出时需要外接上拉电阻确保有足够的驱动能力。

### OLED

![图片](https://user-images.githubusercontent.com/115352148/224482427-b707b8e5-e0bc-4f21-a7ce-223238df488c.png)

### USB转TTL烧写模块

![图片](https://user-images.githubusercontent.com/115352148/224482430-8fb30733-2e31-47c6-b243-053981b4b343.png)

### 蓝牙HC05模块

![图片](https://user-images.githubusercontent.com/115352148/224482434-6a5d8af6-8836-4593-a6ff-afc1e058ff55.png)

STATE与LED相连，能够更明显的显示蓝牙是否连接成功

### MLX90614测温模块
![图片](https://user-images.githubusercontent.com/115352148/224482439-4a686d38-cf39-442f-bc31-4b251785780f.png)

SCL、SDA接P36、P37，与OLED的接线相同，但因为IIC协议从机地址不同，不会产生干扰

## PCB设计

![图片](https://user-images.githubusercontent.com/115352148/224482448-99ccf5bc-12ae-4e4c-a12a-e7c7f8272f65.png)

## 软件设计思路、流程图

### 功能概述

本次实验要完成的任务有：利用MLX90614读取温度，蓝牙模块实现数据传输，LCD、OLED屏幕显示，以及各种按钮和LED的控制。其中LCD、OLED显示和温度读取需要实时更新，所以放在main函数中的while循环内不断执行。蓝牙数据传输就是简单的串口通讯，利用接收中断来实现：当单片机接收到外部的信号时进入中断，对信号进行判断后发送相应的温度数据。按键按下和LED亮灭利用if语句来判断。其中测当前目标温度、选择测温时间、选择报警温度均可通过按钮来实现。

## 测试调试数据和结果

### 上电后开机动画

OLED屏幕和LCD屏幕显示不同的内容

### 测温主界面

LCD屏幕显示当前的测温模式：SURF－表面温度，BODY－体温。显示用户，USER0；显示日期7.6；右下角显示报警温度35。中间则显示当前温度传感器读到的温度值。右上角显示当前测温时间0-11

### 测温副界面

OLED屏幕显示储存的12个温度值，还未读入的为0.0，已经读入的保留二位小数。
### 

### 按下按钮测当前温度

若超过预警则在LCD显示温度的位置显示！！！！！，警告灯亮，蜂鸣器报警；若正常则正常显示温度，并保留该温度一段时间，在OLED对应的位置显示。



### 按下按钮选择报警温度


### 按下按钮选择测温时间并把温度读到OLED对应位置

### 蓝牙传输

蓝牙连接成功后单片机亮蓝灯。

手机向单片机发送0-11则单片机返回对应编号的温度的十六进制值。若发送的不是0-11则单片机返回相同的数值供蓝牙调试。![图片](https://user-images.githubusercontent.com/115352148/224482561-a49101b7-b42e-4995-a98a-ebd7a31b2e44.png)

1B 5F即存储的温度值26.91°C

## 设计过程中的问题，办法

### csv文件导入出错

不能直接在csv文件中修改，需要先转化为txt再修改。

### 滤波电容

设计原理图和PCB时对滤波电容的连接与否存在问题，询问老师后得知每个器件的VCC输入端最好都接一个滤波电容。后提出疑问：那画PCB的时候不就相当于每个滤波电容并联了吗？老师回答说PCB绘制时每个器件的滤波电容最好放置在器件旁边。

### 非向导模式的PCB绘制

在绘制LCD1602的库时，焊盘的位置总是在正中间，询问学长后得知可以不用向导模式绘制。

### 拿到PCB板时三极管的三个焊盘离得太近

小心翼翼地焊，焊完后用万用表检查，发现没有问题。

### 软件编写时单片机内部ROM空间不足

注释掉一些不用的函数，减少变量定义，将函数优化的更简洁明了。

### 蓝牙无法进入AT调试模式

查找了许多资料后发现，只有在给蓝牙上电时按住某个按钮才能进入AT模式。

### 蓝牙连接单片机时出错，OLED、LCD不显示

9V电池无法给这么多器件正常供电，将蓝牙用3.3V的从电脑接出来的电压后恢复正常。

## 体会、总结、感想

这是我第一次碰到的综合实验课，需要我们自己进行系统设计、焊接、软件设计与调试。第一周我们主要学习了Cadence软件的应用，绘制了系统的原理图和各种器件的库文件。在原理图的绘制过程中，我需要自己寻找各个器件的说明文档，并在原理图上做好各接口的连接与定义。开始时绘制的原理图虽然跟我们后面绘制的PCB关系不大，但也是十分重要的一步，它让我们对自己设计的系统有清晰的了解和认识，并提前规划好了相关接口的连接，在后续过程中遇到问题时回看原理图能很快解决。

接着是PCB绘制，器件的布局与布线。在PCB绘制过程中我总会发现很多可以优化的地方，减少PCB的复杂程度，这时总要回过头对原理图进行修改。布局时我做过很多尝试，尽量把有共用接口的器件靠近，这样能减少绕线，在多次尝试后实现了一个相对满意的布局。走线时我先搜索了一下PCB走线技巧，看到上层横走、底层竖走，这样会显得走线干净整洁。在考虑布局时还要注意焊接后的器件不能碰撞冲突，我给LCD和OLED留了一定的间隙但在焊接时发现还是重叠了一部分，焊的并不怎么美观，这是一点遗憾，以后在布局时最好框出整个器件的边界。焊接时有几个焊盘和走线离得很近，焊接时很惊险，下次设计时同样应该注意。

软件调试的时候也遇到很多问题：单片机内存不够导致很多想实现的功能都没有实现，只好完成了较低配版本，后悔在开始时没有选择外接一个ROM。但好在还是完成了大部分开始时想要完成的功能。

第一次接触从0开始的硬件设计，觉得很有趣所以在课后的下午总是留下来继续做，进度很快，第二个星期结束后就基本完成了所有工作。老师和助教也很nice，会积极解答我提出的疑问并与我讨论。总的来说，这两个星期学到了很多，收获颇丰，相信也为我后续课程奠定了坚实的基础。
